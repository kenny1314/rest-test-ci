name: Java CI with Gradle

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  deploy:

    runs-on: ubuntu-latest

    steps:
      - name: Deploy Digital Ocean
        uses: appleboy/ssh-action@master
        with:
          host: ${{secrets.DEPLOY_HOST}}
          key: ${{secrets.DEPLOY_KEY}}
          username: ${{secrets.DEPLOY_USERNAME}}
          script: |
            curl -L https://services.gradle.org/distributions/gradle-7.4.2-all.zip -o gradle-7.4.2-all.zip
            apt-get install -y unzip
            unzip gradle-7.4.2-all.zip
            echo 'export GRADLE_HOME=/app/gradle-7.4.2-all' >> $HOME/.bashrc
            echo 'export PATH=$PATH:$GRADLE_HOME/bin' >> $HOME/.bashrc
            /bin/bash -c "source $HOME/.bashrc"
            cd /home/prj1/rest-test
            gradle installSumService
